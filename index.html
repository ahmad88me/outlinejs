<!DOCTYPE html>
<html>
    <head>
        <script>
            function OutlineGraph(ctx, data){
                if(!("radius" in data)){
                    data["radius"] = 25;
                }
                if(!("y" in data)){
                    data["y"] = ctx.canvas.clientHeight/2
                }
                if(!("start_x" in data)){
                    data["start_x"] = data["radius"] * 1.5
                }
                if(!("end_x" in data)){
                    data["end_x"] = ctx.canvas.clientWidth - data["radius"] * 1.5
                }
                if(!("circle_line_width" in data)){
                    data["circle_line_width"] = 1;
                }
                if(!("edge_line_width" in data)){
                    data["edge_line_width"] = 1;
                }
                if(!("title_y" in data)){
                    data["title_y"] = (ctx.canvas.clientHeight - data["radius"])/4;
                }
                if(!("items_y_gap" in data)){
                    data["items_y_gap"] = data["radius"];
                }
                if(!("items_y" in data)){
                    data["items_y"] = data["y"] + data["radius"] + data["items_y_gap"];
                }
                if(!("points" in data)){
                    data["points"] = [];
                }
                else{
                    var i
                    for(i=0;i<data["points"].length;i++){
                        if(!("title" in data["points"][i])){
                            data["points"][i]["title"] = ""
                        }
                        if(!("items" in data["points"][i])){
                            data["points"][i]["items"] = []
                        }
                    }
                }
                this.data = data
                this.draw_edge = function(x1, x2){
                    ctx.moveTo(x1, this.data["y"]-this.data["radius"]/2);
                    ctx.lineTo(x2, this.data["y"]-this.data["radius"]/2);
                    ctx.lineWidth = this.data["edge_line_width"];
                    ctx.stroke();
                    ctx.moveTo(x1, this.data["y"]+this.data["radius"]/2);
                    ctx.lineTo(x2, this.data["y"]+this.data["radius"]/2);
                    ctx.lineWidth = this.data["edge_line_width"];
                    ctx.stroke();
                }
                this.draw_points = function(){
                    if(this.data["points"].length>1){
                        var i
                        var points_x = [this.data["start_x"]]
                        var gap=(data["end_x"] - data["start_x"])/(data["points"].length-1)
                        for(i=1;i<(data["points"].length-1);i++){
                            this.draw_a_point(this.data["start_x"]+(i*gap) , "mid", this.data["points"][i]["title"], this.data["points"][i]["items"])
                            points_x.push(this.data["start_x"]+(i*gap));
                        }
                        points_x.push(this.data["end_x"]);
                        this.draw_a_point(this.data["start_x"], "start", this.data["points"][0]["title"], this.data["points"][i]["items"])
                        this.draw_a_point(this.data["end_x"], "end", this.data["points"][this.data["points"].length-1]["title"], this.data["points"][i]["items"])
                        //Draw the edges
                        for(i=0;i<this.data["points"].length-1;i++){
                            this.draw_edge(points_x[i]+this.data["radius"], points_x[i+1]-this.data["radius"]);
                        }
                    }
                    else{
                        this.draw_a_point((this.data["end_x"] - this.data["start_x"])/2, "only", this.data["points"][0]["title"], this.data["points"][i]["items"])
                    }
                };// draw points
                this.draw_a_point = function(x, loc, title, items){
                    var from_angle, to_angle;
                    var angle = Math.asin(0.5);
                    if(loc=="start" || loc=="end"){
                        if(loc=="start"){
                            from_angle = angle;//0.25*Math.PI;
                            to_angle = -angle;//1.75 * Math.PI;
                        }
                        else if(loc=="end"){
                            from_angle = Math.PI + angle;//1.25*Math.PI;
                            to_angle = Math.PI - angle;//0.75 * Math.PI;

                        }
                        ctx.beginPath();
                        ctx.arc(x,this.data["y"],this.data["radius"],from_angle,to_angle);
                        ctx.lineWidth = this.data["circle_line_width"];
                        ctx.stroke();
                    }
                    else if(loc=="only"){
                        ctx.beginPath();
                        ctx.arc(x,this.data["y"],this.data["radius"],0, 2 * Math.PI);
                        ctx.lineWidth = this.data["circle_line_width"];
                        ctx.stroke();
                    }
                    else{
                        ctx.beginPath();
                        //ctx.arc(x,this.data["y"],this.data["radius"],0.25*Math.PI, 0.75 * Math.PI);
                        ctx.arc(x,this.data["y"],this.data["radius"], angle, Math.PI - angle);
                        ctx.lineWidth = this.data["circle_line_width"];
                        ctx.stroke();
                        ctx.beginPath();
                        //ctx.arc(x,this.data["y"],this.data["radius"],1.25*Math.PI, 1.75 * Math.PI);
                        ctx.arc(x,this.data["y"],this.data["radius"], Math.PI + angle, -angle);
                        ctx.lineWidth = this.data["circle_line_width"];
                        ctx.stroke();
                    }
                    ctx.font = "15px Comic Sans MS";
                    ctx.fillStyle = "red";
                    ctx.textAlign = "center";
                    ctx.fillText(title, x, this.data["title_y"]);
                    var i
                    ctx.font = "10px Comic Sans MS";
                    ctx.fillStyle = "green";
                    ctx.textAlign = "center";
                    for(i=0;i<items.length;i++){
                        ctx.fillText(items[i], x, this.data["items_y"]+ (i * data["items_y_gap"]));
                    }
                };//  draw a point
                
                
                
                
                this.draw_an_inner_edge = function(x1, x2){
                    ctx.beginPath();
                    ctx.moveTo(x1, this.data["y"]);
                    ctx.lineTo(x2, this.data["y"]);
                    ctx.lineWidth = this.data["radius"] * 0.5;
                    ctx.strokeStyle = "green";
                    ctx.stroke();
                }
                
                this.draw_inner_edges = function(index){
                    var gap=(this.data["end_x"] - this.data["start_x"])/(this.data["points"].length-1)
                    for(i=0;i<index;i++){
                    //for(i=0;i<this.data["points"].length-1;i++){
                        // with gap between the point and the edge
                        //this.draw_an_inner_edge(this.data["start_x"]+(i*gap)+this.data["radius"], this.data["start_x"]+((i+1)*gap)-this.data["radius"]);
                        // with no gap between the point and the edge
                        this.draw_an_inner_edge(this.data["start_x"]+(i*gap), this.data["start_x"]+((i+1)*gap));
                        /*
                        if(i == this.data["points"].length-1){
                            this.draw_an_inner_edge(this.data["start_x"]+(i*gap), this.data["start_x"]+((i+1)*gap));
                        }
                        else{
                            this.draw_an_inner_edge(this.data["start_x"]+(i*gap), this.data["start_x"]+((i+1)*gap-this.data["radius"]));
                        }
                         */
                    }
                }
                
                this.draw_an_inner_point = function(x){
                    ctx.beginPath();
                    ctx.arc(x,this.data["y"],this.data["radius"]*0.6,0, 2 * Math.PI);
                    ctx.fillStyle = "green";
                    ctx.lineWidth = this.data["circle_line_width"];
                    ctx.fill();
                };//  draw an inner point
                
                this.draw_inner_points = function(index){
                    var gap=(this.data["end_x"] - this.data["start_x"])/(this.data["points"].length-1)
                    var i
                    for(i=0;i<index;i++){
                        this.draw_an_inner_point(this.data["start_x"]+(i*gap));
                    }
                };// draw inner points
                this.draw_inner = function(index){
                    this.draw_inner_points(index);
                    this.draw_inner_edges(index-1);
                }
                 this.draw = function(){
                     this.draw_points();
                     //this.draw_inner(index);
                 }
                
                
                
                
                
            }
        </script>
    </head>
    <body>
        <canvas id="myCanvas" width="600" height="200"
                                          style="border:1px solid #d3d3d3;">
            Your browser does not support the canvas element.
        </canvas>
        <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        ctx.canvas.width  = window.innerWidth;
        var data = [
            {"title": "point1", "items": ["item1", "item2"]}
        ]
        //d(ctx, data);
        //draw_circle_start(ctx)
        var g = new OutlineGraph(ctx, {
                                 "points": [
                                    {"title": "my title", "items": ["item1", "item2"]},
                                     {"title": "frutas", "items": ["manzana", "naranja"]},
                                     {"title": "vegetales", "items": ["lechuga", "Zanahoria"]},
                                    {"title": "fruits", "items": ["apple", "orange"]}
                                 ]});
        //g.draw_points();
        g.draw();
        g.draw_inner(2);
        </script>
    </body>

</html>
    
